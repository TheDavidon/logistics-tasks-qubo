\documentclass{article}

\usepackage[utf8x]{inputenc}
\usepackage[russian]{babel}
\usepackage{amsmath}

\title{QUBO формулировка для задачи с дискретными грузами и одним агентом}
\date{}

\begin{document}

\maketitle

\section{Неформальная постановка задачи}
\par
Дан полный взвешенный (без отрицательных ребер) граф, который представляет собой граф расстояний изначальной транспортной сети. Вводится понятие груза. Груз характеризуется тремя числами - вес, начальная вершина и конечная вершина. Есть набор грузов - множество троек чисел \((W_i, S_i, F_i)\), характеризующих груз. Каждый груз должен был транспортирован из своей начальной вершины в конечную. Есть транспортное средство (машина), которое эти грузы доставляет. Оно должно стартовать и заканчивать путь в фиксированных вершинах. У транспортного средства есть вместимость - суммарная величина грузов, которые он может перевозить вместе (аналог размера рюкзака). Машина может двигаться по произвольному пути на графе и забирать/отдавать грузы со следующими ограничениями: если груз взят, то его можно отдать только на конечной вершине груза и нигде более, а также в произвольный момент времени в машине не может быть грузов суммарным весом больше, чем ее вместимость. Задача заключается в том, чтобы найти такой путь машины (набор вершин и последовательность действий с грузами), который будет удовлетворять ограничениям выше и при этом минимизировать вес пути (сумму весов ребер на пути)

\section{Общая логика модели}

Основа модели - классическая для транспортных задач в QUBO. Мы фиксируем кол-во вершин в пути агента = $q$, само значение определяется с помощью эвристик под конкретные входные данные (пример будет предоставлен ниже). В рамках параметризации действий с грузами есть два принципиально разных пути, первый - динамическое поддержание состояния багажа машины, то есть набор переменных, характеризующий набор грузов в машине на каждый момент времени. С этим подходом достаточно просто выглядит перевод ограничений на вместимость машины, но сильно усложняются ограничения на корректность доставки грузов. С учетом того, что в текущей постановке задачи машина должна развезти все грузы, мы выбрали "статический" подход, при котором состояние багажа машины не поддерживается явно, а для каждого груза, с другой стороны, явно выбирается номера вершины в пути, на котором груз забирают и на котором груз отдают. А ограничения на вместимость восстанавливаются по этой информации. В такой формулировке любое корректное решение уже будет удовлетворять ограничению на доставку всех грузов, без дополнительных гамильтонианов, как в первом варианте. \par

Основные переменные содержат всю информацию об итоговом пути и действиях агента. Вспомогательные переменные нужны для построения гамильтонианов и проверки корректности полученного решения. Константы - величины, известные из входных данных. Вспомогательные выражения - перевод бинарной кодировки величин в их численное значение \par

Гамильтониан, который преобразуется в квадратичную форму для QUBO, разделен на несколько слагаемых. Гамильтонианы корректности системы отвечают за то, что по бинарным переменным можно восстановить корректный путь и действие:
\begin{itemize}
    \item правильная начальная и конечная вершина
    \item за каждый ход посещена единственная вершина
    \item каждый груз должен быть взят на ходу с номером меньше, чем номер хода, на котором он отдан
    \item если груз взят на i-ом ходу, то посещенная на i-ом ходу вершина должна быть равна вершине $S_i$
    \item если груз отдан на i-ом ходу, то посещенная на i-ом ходу вершина должна быть равна вершине $F_i$
    \item на момент каждого хода величина груза в машине не превосходит вместимость


\end{itemize}
Гамильтониан целевой функции один и отвечает за минимизацию веса пути\par

В итоговой сумме каждый гамильтониан входит в коэффициентом, который нужен, чтобы каждое ограничение выполнялось и не вытесняло остальные.




\section{Переменные и вспомогательные величины}


\subsection{Основные бинарные переменные}
$x_{ij}$ - на i-ом шаге была посещена j-ая вершина. Кол-во переменных: \(qn\)\\
$a_{ij}$ - i-ый груз был взят на j-ом ходу. Кол-во переменных: \(qm\) \\
$b_{ij}$ - i-ый груз был отдан на j-ом ходу. Кол-во переменных: \(qm\)


\subsection{Вспомогательные бинарные переменные}
\(y_{ij}\) - j-ая переменная в кодировке величины груза агента на i-ом ходу. Кол-во переменных: \(q(M+1)\) \\

Суммарное кол-во переменных: \(q(2m + n + M + 1)\)


\subsection{Константы}
\[n - \text{кол-во вершин}\]
\[m - \text{кол-во грузов}\]
\[C - \text{вместимость машины}\]
\[S, F - \text{индексы начальной и конечной вершины пути машины}\]
\[W_i - \text{вес i-ого груза}\]
\[S_i, F_i - \text{индексы начальной и конечной вершины i-ого груза}\]
\[d_{ij} - \text{вес ребра между вершинами i и j}\]
\[q - \text{кол-во вершин в пути агента}\]
\[M = \left \lfloor{log_{2} C}\right \rfloor \]







\subsection{Вспомогательные выражения}
\[L_{i} = \sum_{j=0}^{M-1} 2^j y_{ij} + y_{i M} (C + 1 - 2^M) \text{ - величина груза в машине на i-ом ходу}\]
\[T_{ij} = \sum_{k=0}^{i} (a_{jk} - b_{jk}) \text{ - на i-ом ходу в машине находится j-ый груз}\]

\section{Гамильтонианы}

\subsection{Гамильтонианы корректности системы}

\[H_{correct \ path} \ = \sum_{i=0}^{q - 1} (1-\sum_{j=0}^{n-1}x_{ij})^2\]\\
\[H_{correct \ take \ action} \ = \sum_{i=0}^{m - 1} (1-\sum_{j=0}^{q-1}a_{ij})^2\]\\
\[H_{correct \ give \ action} \ = \sum_{i=0}^{m - 1} (1-\sum_{j=0}^{q-1}b_{ij})^2\]\\

\[H_{correct \ end \ points} \ = \ (2 - x_{0, S} -x_{q-1, F})^2 \]\\
\[H_{correct \ take \ vertex} \ =\ \sum_{i=0}^{m-1} \sum_{j=0}^{q-1}(1 - x_{jS_{i}})a_{ij} \]\\
\[H_{correct \ give \ vertex} \ =\ \sum_{i=0}^{m-1} \sum_{j=0}^{q-1}(1 - x_{jF_{i}})a_{ij} \]\\
\[H_{correct \ take/give \ order} \ =\sum_{i=0}^{m-1} \sum_{j=0}^{q-1} T_{ji} (T_{ji} - 1) \]\\

\[H_{correct \ load, \ k} \ =\ (L_{k} - \sum_{i=0}^{m-1} W_{j} T_{ki})^2 \]\\
\[H_{correct \ loads} \ =\ \sum_{k=0}^{q-1}H_{correct \ load, \ k}\]\\


\subsection{Гамильтонианы целевой функции}
\[H_{path \ length} \ =\ \sum_{u, v = 0}^{n-1} \sum_{i=0}^{q-2}x_{i,u}x_{i+1, v} d_{uv}\]\\


\end{document}